server {
  listen 8080;
  server_name _;
  root /usr/share/nginx/html;
  index login.html;

  # ---- PROXY: läggs före "/" och med SLASH på proxy_pass ----
  # login-api (korrekt väg via proxyn: /api/login/<rest> -> /<rest> mot backend)
  location ^~ /api/login/ {
    proxy_pass http://wo-m-project-1-login-api:3001/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
  }

  # notes-api
  location ^~ /api/notes/ {
    proxy_pass http://wo-m-project-1-notes-api:3002/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
  }

  # ---- KOMPAT: fånga felaktiga gamla URL:er /:3001/... och /:3002/... ----
  location ^~ /:3001/ {
    rewrite ^/:3001/(.*)$ /$1 break;  # strip :3001
    proxy_pass http://wo-m-project-1-login-api:3001/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
  }
  location ^~ /:3002/ {
    rewrite ^/:3002/(.*)$ /$1 break;  # strip :3002
    proxy_pass http://wo-m-project-1-notes-api:3002/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
  }

  # Statik / enkel fallback
  location / {
    try_files $uri $uri/ /login.html;
  }
}
